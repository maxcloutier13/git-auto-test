name: 'Release to steam'

on:
  release:
    types: [published]

jobs:
  upload-to-steam:
    name: Upload to Steam Workshop
    if: ${{ !github.event.release.prerelease }} # Do not upload pre releases
    runs-on: windows-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
    #- name: Build with HEMTT
    #  uses: gruppe-adler/action-release-with-hemtt@2.2.0
    #  id: build
    - name: Build with Mikero
    - run: |
        "C:\Program Files (x86)\Mikero Free\DePboTools\bin\pboProject.exe" -P "P:\CGQC" -Mod="D:\SteamLibrary\steamapps\common\Arma 3\!Workshop\@CGQC - Core - WIP"
      name: Build
    - name: Upload mod
      uses: gruppe-adler/action-release-to-steam-ws@v1-beta
      with:
        file_id: 2837988642
        username: "${{ secrets.STEAM_USERNAME }}"
        password: "${{ secrets.STEAM_PASSWORD }}"
        path: "${{ secrets.core_wip_folder }}"
        name: CGQC_Core
        change_notes_title: "${{ github.event.release.name }}"
        change_notes: "${{ github.event.release.body }}"